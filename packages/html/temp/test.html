
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8"/>
	<title></title>
	<!--	<script-->
	<!--			src="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/js/jquery-1.7.2.min.js"-->
	<!--			type="text/javascript"-->
	<!--	></script>-->
	<script src="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/js/adaptive.js" type="text/javascript"></script>
	<script src="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/js/common.js" type="text/javascript"></script>
	<script src="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/js/EventEmitter.min.js"></script>
	<script src="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/js/art-template.js"></script>
	<script src="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/js/jf.js?v=2021020301"></script>
	<link href="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/css/index_new.css" rel="stylesheet" type="text/css"/>
	<style>
		.icon-box {
			position: fixed;
			right: 20px;
			bottom: 170px;
			z-index: 9999;
			animation: index-bounce 1.5s infinite;
			visibility: hidden;
		}

		.ad-icon {
			animation: index-bounce 1.5s infinite;
		}

		@keyframes index-bounce {
			25% {
				transform: scale(1.1);
			}
			50%,
			100% {
				transform: scale(1);
			}
			75% {
				transform: scale(1.1);
			}
		}
	</style>
</head>
<body>
<div
		style="
        display: flex;
        flex-direction: column;
        height: 100%;
        overflow: hidden;
      "
>
	<div id="wrapper" style="flex: 1; overflow: auto">
		<div style="padding: 0.32rem; padding-bottom: 0 !important">
			<div
					id="title"
					style="
              color: #333333;
              font-size: 24px;
              font-weight: bolder;
              text-align: justify;
            "
			></div>
			<div id="top-ad" style="display: none; margin: 10px 0">
				<script id="ad-wrap-float" type="text/html">
					<div
							class="ad-wrap-float top-xuanfu"
							onclick="Ad.adClick({{clickUrl}},{{dUrl}},{{pid}},3,getParam('from_user_id'),{{page}},{{ad_platform}},{{ad_material_id}})"
					>
						<img class="ad-img" src="{{srcUrls[0]}}" alt=""/>
					</div>
				</script>
			</div>
			<!--文章内容-->
			<div
					id="contentParent"
					style="
              margin-top: 0.06rem;
              position: relative;
              height: 2.8rem;
              overflow: hidden;
            "
			>
				<div id="content">
					<div class="acticle_cont" style="display: block">
						<div class="article_box"></div>
					</div>
				</div>
				<div
						id="openAll"
						onclick="openAll()"
						style="position: absolute; top: 1.19rem; left: 0"
				>
					<img
							src="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/img/ckqw.png"
					/>
				</div>
			</div>

			<div style="margin-top: 0.36rem">
				<img
						src="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/img/rmtj.png"
						style="height: 0.34rem"
				/>
			</div>
			<div id="dataList"></div>
			<!--广告-->
			<div class="container" style="padding-bottom: 3%; margin-top: 0vh">
				<!--单图-->
				<script id="ad-template-info" type="text/html">
					<div
							class="ad-template-info"
							style="display: flex;justify-content: space-between;height: 1.86rem;margin-top: 0.24rem"
							onclick="Ad.adClick({{clickUrl}},{{dUrl}},{{pid}},1,getParam('from_user_id'),{{page}},{{ad_platform}},{{ad_material_id}})"
					>
						<div style="width: 65%">
							<div
									class="line-two"
									style="font-size: 16px;color: #333333;font-weight: bolder;line-height: 0.44rem;"
							>
								{{ title }}
							</div>
							<div
									style="display: flex;justify-content: space-between;margin-top: 0.28rem;color: rgba(153, 153, 153, 1)"
							>
                    <span
		                    style="color: rgba(153, 153, 153, 1)!important;font-size: 14px;"
                    >
                      <img
		                      src="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/img/eye.png"
		                      style="margin-top: -0.04rem;margin-right: 0.06rem;width: 0.28rem;height: 0.28rem;"
                      /><span>{{ readNum }}次观看</span>
                    </span>
								{{ date }}
							</div>
						</div>
						<div
								style="width: 2rem;height: 1.6rem;padding-right: 0rem;line-height: 1.4rem"
						>
							<img
									src="{{srcUrls[0]}}"
									style="height: 1.6rem;border-radius: 4px;"
							/>
						</div>
					</div>
					<div style="height: 1px;background: #EEEEEE;width: 94vw;"></div>
				</script>
				<!--三图-->
				<script id="ad-template-3img" type="text/html">
					<div
							class="ad-template-3img"
							style="padding: 0.24rem 0"
							onclick="Ad.adClick({{clickUrl}},{{dUrl}},{{pid}},2,getParam('from_user_id'),{{page}},{{ad_platform}},{{ad_material_id}})"
					>
						<div
								class="line-two"
								style="padding: 0 0rem;font-weight: bolder;line-height: 0.44rem;color: #333;font-size: 16px!important;"
						>
							{{ title }}
						</div>
						<div
								style="display: flex;justify-content: space-between;padding: 0 0rem;margin-top: 0.2rem"
						>
							{{ each srcUrls as value }}
							<img
									style="height: 1.4rem;border-radius: 4px;"
									src="{{value}}"
									alt=""
							/>
							{{ /each  }}
						</div>
						<div
								style="display: flex;justify-content: space-between;margin-top: 0.14rem;padding: 0 0rem;color: rgba(153, 153, 153, 1)"
						>
                  <span style="color: rgba(153, 153, 153, 1);font-size: 14px;">
                    <img
		                    src="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/img/eye.png"
		                    style="margin-top: -0.04rem;margin-right: 0.06rem;width: 0.28rem;height: 0.28rem"
                    /><span>{{ readNum }}次观看</span>
                  </span>
							{{ date }}
						</div>
					</div>

					<div style="height: 1px;background: #EEEEEE;width: 94vw;"></div>
				</script>
				<!--大图-->
				<script id="ad-template-info-big" type="text/html">
					<div
							class="ad-template-info-big"
							style="padding: 0.24rem 0"
							onclick="Ad.adClick({{clickUrl}},{{dUrl}},{{pid}},3,getParam('from_user_id'),{{page}},{{ad_platform}},{{ad_material_id}})"
					>
						<div
								class="line-two"
								style="padding: 0 0rem;font-weight: bolder;line-height: 0.44rem;color: #333;font-size: 16px!important;"
						>
							{{ title }}
						</div>
						<div
								style="display: flex;justify-content: space-between;padding: 0 0rem;margin-top: 0.2rem"
						>
							<img
									style="height: 4.56rem;width: 100%;border-radius: 4px;"
									src="{{srcUrls[0]}}"
									alt=""
							/>
						</div>
						<div
								style="display: flex;justify-content: space-between;margin-top: 0.28rem;padding: 0 0rem;color: rgba(153, 153, 153, 1)"
						>
                  <span style="color: rgba(153, 153, 153, 1);font-size: 14px;">
                    <img
		                    src="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/img/eye.png"
		                    style="margin-top: -0.05rem;margin-right: 0.08rem;width: 0.28rem;height: 0.28rem"
                    /><span>{{ readNum }}次观看</span>
                  </span>
							{{ date }}
						</div>
					</div>
					<div style="height: 1px;background: #EEEEEE;width: 94vw;"></div>
				</script>
				<div
						id="footer"
						style="display: none; height: 1.86rem; background-color: #fff"
				>
					<div
							id="ad"
							style="
                  height: 100%;
                  display: flex;
                  align-items: center;
                  justify-content: space-between;
                "
					>
						<!-- <p
						  class="ad-title"
						  style="
							width: 65%;
							font-size: 16px;
							color: #333;
							font-weight: bold;
							line-height: 0.44rem;
							text-overflow: -o-ellipsis-lastline;
							overflow: hidden;
							text-overflow: ellipsis;
							display: -webkit-box;
							-webkit-line-clamp: 2;
							line-clamp: 2;
							-webkit-box-orient: vertical;
						  "
						></p> -->
						<div
								style="
                    width: 65%;
                    display: flex;
                    flex-direction: column;
                    color: rgba(153, 153, 153, 1);
                  "
						>
							<div
									class="ad-title"
									style="
                      font-size: 16px;
                      color: #333333;
                      font-weight: bolder;
                      line-height: 0.44rem;
                      text-overflow: -o-ellipsis-lastline;
                      overflow: hidden;
                      text-overflow: ellipsis;
                      display: -webkit-box;
                      -webkit-line-clamp: 2;
                      line-clamp: 2;
                      -webkit-box-orient: vertical;
                    "
							></div>
							<div style="margin-top: 0.28rem">
                    <span
		                    style="
                        color: rgba(153, 153, 153, 1) !important;
                        font-size: 14px;
                      "
                    >
                      <img
		                      src="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/img/eye.png"
		                      style="
                          margin-top: -0.04rem;
                          margin-right: 0.06rem;
                          width: 0.28rem;
                          height: 0.28rem;
                        "
                      />
                      <span>354853次观看</span>
                    </span>
							</div>
						</div>
						<img
								class="ad-image"
								src=""
								style="width: 2rem; height: 1.6rem; border-radius: 4px"
						/>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="icon-box">
		<img class="ad-icon" src="" style="width: 60px; height: 60px"/>
	</div>
</div>
<script src="http://cp4gzh.oss-cn-shanghai.aliyuncs.com/static/js/ad_pure.js?v=20210202047"></script>
<!-- <script src="./ad_pure.js?v=20210202017"></script> -->
<script>
	var adLink = [];

	function commonGetTwo(url, success, headers, fail) {
		$.ajax({
			type: "GET",
			url: "https://gzh.shortl.cn" + url,
			// url: 'http://api.17code.net/h5' + url,
			success: success,
			fail: fail,
			headers: headers,
		});
	}

	var ip = "";
	var more_click = 0;
	// 获取文章信息
	commonGetTwo(
		"/ws/h5/articles/" +
		getParam("article_id") +
		"?from_user_id=" +
		getParam("from_user_id") +
		"",
		function (res) {
			if (res.code == 200) {
				$("#title").html(res.data.title);
				$("title").html(res.data.title);
				$(".article_box").html(
					res.data.content.replace(/data-src/g, "src")
				);
			}
		}
	);

	// 展开全文
	function openAll() {
		more_click = 1;
		$(".acticle_cont").height("auto");
		$("#contentParent").height($(".acticle_cont").height());
		$("#openAll").hide();
		$("#top-ad").css("display", "block");

		$(".icon-box").css({visibility: "visible"});
	}

	// 广告处理
	var adListIndex = 0;
	var adList = [];
	var deny_cids = []; // 被禁止的创意广告id

	var page = {num: 1, size: 5};
	var maxPgae = 0;
	var url = decodeURI(location.search)
	console.log(url)
	// var stage=
	getAds();

	// 广告列表
	function getAds() {
		commonGetTwo("/ws/h5/adverts?page_type=7&page=" + page.num + "&per_page=" + page.size + "" + '&stage=' + stage,
			function (res) {
				if (res.code == 200) {
					adList = res.data;
					maxPgae = res.meta.last_page;
				}
				ee.emitEvent("fetch-jj-ad");
			}, {"ACT-USER-ID": getParam("user_id")})
	}

	// 拉取广告
	ee.addListener("fetch-jj-ad", function () {

		var curData = adList[adListIndex];
		Ad.singleAd(
			$.extend(curData, {
				data: {app_id: curData.ad_platform == 1 ? 47 : 103164, deny_cids: deny_cids.join(","), ad_platform: curData.ad_platform, adWrapClass: curData.adWrapClass},
			}),
			function (res) {
				if (res && deny_cids.indexOf(res.cid) == -1) {
					deny_cids.push(res.cid);
				}
				if (adListIndex === adList.length - 1) return;
				adListIndex++;
				ee.emitEvent("fetch-jj-ad");
			}
		);
	});

	// 滑动加载
	var condition = true;

	setTimeout(() => {
		$("#wrapper").scroll(function () {
			var scrollTop = $(this).scrollTop();
			var scrollHeight = $(document).height();
			var windowHeight = $(this).height();
			if (
				scrollTop + windowHeight + 250 >= scrollHeight &&
				page.num < maxPgae
			) {
				if (condition) {
					condition = false;
					adListIndex = 0;
					adList = [];
					page.num++;
					getAds();
					setTimeout(function () {
						condition = true;
					}, 1000);
				}
			} else if (page.num >= maxPgae) {
				// // 跳转至退弹
				// getInfoUrl(function (url) {
				//   const query = location.search || "?";
				//   location.href = `${url}/xxl.html${query}&isXxl=1`;
				// });
			}
		});
	}, 1000);

	// 退弹
	getInfoUrl(function (url) {
		const query = location.search || "?";
		gogg(`${url}/xxl.html${query}&isXxl=1`);
	});

	// 获取信息流页地址
	function getInfoUrl() {
		const callback = arguments[0];
		const query = location.search.replace(/user_id/, "from_user_id");

		$.get("https://gzh.shortl.cn/ws/h5/url/info", function (res) {
			if (res.code == 0) {
				callback && callback(res.data);
			}
		});
		return false;
	}

	function gogg(url) {
		history.pushState(
			history.length + 1,
			"message",
			window.location.href.split("#")[0] + "#" + new Date().getTime()
		);
		if (navigator.userAgent.indexOf("Android") != -1) {
			if (typeof tbsJs != "undefined") {
				tbsJs.onReady('{useCachedApi : "true"}', function (e) {});
				window.onhashchange = function () {
					location.href = url;
				};
			} else {
				var pop = 0;
				window.onhashchange = function (event) {
					pop++;
					if (pop >= 3) {
						location.href = url;
					} else {
						history.go(1);
					}
				};
				history.go(-1);
			}
		} else {
			window.onhashchange = function () {
				location.href = url;
			};
		}
	}

	// 获取悬浮广告设置
	function getLayerAd() {
		commonGetTwo("/ws/h5/setting", function (res) {
			if (
				res.data.layer &&
				res.data.layer.length &&
				res.data.layer[0].links &&
				res.data.layer[0].links.length
			) {
				var icon = res.data.layer[0].icon;
				var links = res.data.layer[0].links;
				adLink = links;
				$(".icon-box .ad-icon").attr("src", icon);
			}
			if (res.data.ad) {
				var adData = res.data.ad;
				if (adData && adData.status) {
					$("#footer").css("display", "block");
					$(".ad-image").attr("src", adData.image);
					$(".ad-title").text(adData.title);
					$("#ad").click(function () {
						location.href = adData.url;
					});
				}
			}
		});
	}

	getLayerAd();
	$(".icon-box .ad-icon").click(function () {
		if (adLink.length) {
			location.href = adLink[0];
		}
	});
</script>
<script>
	var _hmt = _hmt || [];
	(function () {
		var hm = document.createElement("script");
		hm.src = "https://hm.baidu.com/hm.js?0f39a789e48f92d1aa47b91bbecc4b44";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hm, s);
	})();
</script>
</body>
</html>
