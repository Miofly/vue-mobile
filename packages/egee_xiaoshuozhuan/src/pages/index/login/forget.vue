<template>
	<view>
		<image src="/static/images/lz/hbg.jpg" class="full-width" style="height: 18rem"></image>
		<view class="bg-white center padding-xl border-radius width-ninety padding-top-xxl">
			<view>
				<view class="fa fa-phone fl margin-right-xl text-red"
					  style="margin-top: -0.2rem;font-size: 50rpx;width: 1rem"></view>
				<view style="border-bottom: 1px solid rgba(0, 0, 0, 0.3)">
					<view v-show="regInfos.mobile" class="fa fa-close fr margin-right-lower"
						  @tap="delVals('mobile')"></view>
					<input v-model="regInfos.mobile" :focus="false" :password="false" placeholder="请输入手机号码"
						   maxlength="11" confirm-type="完成"/>
				</view>
			</view>
			<view class="margin-top-ten">
				<view class="fa fa-commenting-o fl margin-right-xl text-red"
					  style="margin-top: -0.2rem;font-size: 50rpx;width: 1rem"></view>
				<view style="border-bottom: 1px solid rgba(0, 0, 0, 0.3)">
					<!--<view v-show="regInfos.code" class="fa fa-close fr margin-right-lower" @tap="delVals('regInfos.code')"></view>-->
					<input v-model="regInfos.msgCode" :focus="false" :password="false" placeholder="请输入验证码"
						   confirm-type="完成"/>
					<button @tap="btnSend" :disabled="disabled" class="cu-btn fr" style="margin-top: -12%" :class="[['bg-red', 'line-red', 'line-red lines-red'][1],
					        ['sm', 'lg', ''][2], true ? 'round' : '', true ? 'shadow' : '', false ? 'block' : '']">
						<text v-show="false" class="fa fa-wechat padding-right-twenty"></text>
						{{codeMess}}
					</button>
				</view>
			</view>
			<view class="margin-top-ten">
				<view class="fa fa-lock fl margin-right-xl text-red"
					  style="margin-top: -0.2rem;font-size: 50rpx;width: 1rem"></view>
				<view style="border-bottom: 1px solid rgba(0, 0, 0, 0.3)">
					<view v-show="regInfos.password" class="fa fa-close fr margin-right-lower"
						  @tap="delVals('password')"></view>
					<input v-model="regInfos.password" :focus="false" :password="true" placeholder="请输入6-20位密码"
						   confirm-type="完成"/>
				</view>
			</view>
			<view class="margin-top-ten">
				<view class="fa fa-lock fl margin-right-xl text-red"
					  style="margin-top: -0.2rem;font-size: 50rpx;width: 1rem"></view>
				<view style="border-bottom: 1px solid rgba(0, 0, 0, 0.3)">
					<view v-show="regInfos.repassword" class="fa fa-close fr margin-right-lower"
						  @tap="delVals('repassword')"></view>
					<input v-model="regInfos.repassword" :focus="false" :password="true" placeholder="请再次输入密码"
						  confirm-type="完成"/>
				</view>
			</view>
			<view class="margin-top-xl">
				<button @tap="login" class="cu-btn full-width" :class="['text-btn-new',
                    ['sm', 'lg', ''][2], true ? 'round' : '', true ? 'shadow' : '', true ? 'block' : '']">
					修改密码
				</button>
			</view>
			<view class="flex justify-end margin-top-xl">
				<!--<router-link to="{name: 'login'}" class="text-red">已有账号，立即登录</router-link>-->
				<navigator url="/pages/index/login/login" class="text-red">已有账号，立即登录</navigator>
			</view>

			<!--<view class="text-center margin-top-ten">-->
				<!--客服微信:-->
				<!--<text @tap="copy" class="text-red">{{wx}}</text>-->
			<!--</view>-->
		</view>
	</view>
</template>

<script>
	import {
	    commonPost
	} from '@/api'

    export default {
        data() {
            return {
                regInfos: {
                    mobile: '',
                    msgCode: '',
                    password: '',
                    repassword: '',
                    type: 1002
                },
                wx: 'SUNP8694',
                disabled: false,
                codeMess: '获取验证码'
            }
        },
        methods: {
            async btnSend() {
                if (this.regInfos.mobile.trim() == '') {
                    this.ui.showToast('手机号不能为空')
                    return
                }
                const data = await commonPost('/bus/send', this.regInfos)
                // console.log(data)
                this.ui.showToast(data.message)

                if (data.code == 200) {
                    this.disabled = true
                    this.codeMess = '请稍候...'
                    setTimeout(() => {
                        this.doLoop(60)
                    }, 500)
                }
            },
            doLoop(seconds) {
                seconds = seconds || 60
                this.codeMess = seconds + 's后获取'
                const countdown = setInterval(() => {
                    if (seconds > 0) {
                        this.codeMess = seconds + 's后获取'
                        --seconds
                    } else {
                        this.codeMess = '获取验证码'
                        this.disabled = false
                        clearInterval(countdown)
                    }
                }, 1000)
            },
            delVals(val) {
                this.regInfos[val] = ''
            },
            copy() {
                this.tu.getClipboardData(this.wx)
            },
            async login() {
                if (this.regInfos.mobile.trim() == '') {
                    this.ui.showToast('手机号不能为空')
                    return
                }
                if (this.regInfos.msgCode.trim() == '') {
                    this.ui.showToast('验证码不能为空')
                    return
                }
                if (this.regInfos.password.trim() == '') {
                    this.ui.showToast('密码不能为空')
                    return
                }
                if (this.regInfos.repassword.trim() == '') {
                    this.ui.showToast('密码不能为空')
                }
                const data = await commonPost('/auth/forget', this.regInfos)
                this.ui.showToast(data.message)
                if (data.code == 200) { // 注册成功跳转登录页面
                    setTimeout(() => {
                        // this.router.push({name: 'login'})
                        uni.redirectTo({
                            url:'/pages/index/login/login'
                        })
                    }, 2000)
                }
                // console.log(data)
            },
        },
    }
</script>
